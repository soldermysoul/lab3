<!DOCTYPE html>
<html>

<head>
<title> Sign Up Page </title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
<div class=row>
<div class="col-md-6 offset-md-3">
<div class="card border-dark">
<div class="card-header border-info text-white bg-info">
<b>Signup Form</b>
</div>
<div class="card-body border-dark text-left">





								<h1> Sign Up </h1>
							<form id="signupForm" action="welcome.html">   
								First Name: <input type="text"  name="fName"><br>
								Last Name:  <input type="text"  name="lName"><br>
								Gender:     <input type="radio" name="gender" value="m"> Male<br>
											<input type="radio" name="gender" value="f"> Female<br>
		
								Zip Code:   <input type="text"  id="zip" name="zip"><br>
								City:       <span id="city"></span><br>
								Latitude:   <span id="latitude"></span><br>
								Longitude:  <span id="longitude"></span><br>
		
								State:  <select id="state"></select><br>
		
								Select a County: <select id="county"></select><br>
		
								Desired Username: <input type="text" id="username" name="username"><br>
		
								Password:         <input type="password" id="password" name="password"><br>
												  <span id="usernameError"></span><br>
								Password Again:   <input type="password" id="passwordAgain">
												  <span id="passwordAgainError"></span> <br /><br>
						  
		
<input type="submit" class="btn btn-lg btn-info" value="Sign Up!">
	
</form>  
</div>

</div>   

</div>
</div>

    <script>
    
        var usernameAvailable = false;
        
        // Displaying City from API after typing a zip code
        $("#zip").on("change", async function(){
            
            // alert($("#zip").val());
            let zipCode = $("#zip").val();
            let url = `https://itcdland.csumb.edu/~milara/ajax/cityInfoByZip.php?zip=${zipCode}`;
            let response = await fetch(url);
            let data = await response.json();
            // console.log(data)
            $("#city").html(data.city);
            $("#latitude").html(data.latitude);
            $("#longitude").html(data.longitude);
            
        }); // zip
        
        $("#state").on("change", async function(){
            
            // alert($("#state").val());
            let state = $("#state").val();
            let url = `https://cst336.herokuapp.com/projects/api/state_abbrAPI.php?state=${state}`;
            let response = await fetch(url);
            let data = await response.json();
             $("#state").html("<option> Select One </option>");
            data.forEach ( function(i) {
                $("#state").append(`<option> ${i.state} </option>`);
                
            let url = `https://itcdland.csumb.edu/~milara/ajax/countyList.php?state=${state}`;
            let response = await fetch(url);
            let data = await response.json();
            // console.log(data)
            $("#county").html("<option> Select One </option>");
            data.forEach ( function(i) {
                $("#county").append(`<option> ${i.county} </option>`);
            });
            
        }); // state
        
        $("#username").on("change", async function(){
            
            // alert ($("#username").val());
            let username =$("#username").val();
            let url = `https://cst336.herokuapp.com/projects/api/usernamesAPI.php?username=${username}`;
            let response = await fetch(url);
            let data = await response.json();
            
            if (data.available) {
                $("#usernameError").html("Username available!");
                $("#usernameError").css("color","green");
                usernameAvailable = true;
            } else {
                $("#usernameError").html("Username not available!");
                $("#usernameError").css("color","red");
                usernameAvailable = false;
            }
            
        }); // username
        
        $("#signupForm").on("submit", function(e){
            // alert(usernameAvailable);
            if (!isFormValid()) {
                e.preventDefault();
            }
            
        });
        
        function isFormValid(){
            var isValid = true;
            if (!usernameAvailable) {
                isValid = false;
            }
            
            if ($("#username").val().length == 0) {
                isValid = false;
                $("#usernameError").html("Username is required");
            }
            
            if ($("#password").val() != $("#passwordAgain").val()){
                $("#passwordAgainError").html("Password Mismatch!"); 
                isValid = false;
            }
            
         if ($("#password").val.length < 6 ){
                alert("Error: Password must contain at least six characters!");
                form.passwordLength();
                isValid = false;
             }
                
            return isValid;
        }
        
         $("#signupForm").on("submit", function(event) {
            
            // alert("Submitting form...");
            if (!isFormValid()) {
             event.preventDefault();
            }
            
        }); // signup form
        
    </script>
    
    </body>
    
</html>